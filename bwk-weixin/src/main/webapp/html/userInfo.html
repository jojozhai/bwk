<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <title>个人信息</title>
    <link rel="stylesheet" href="../css/frozen.css">
    <link rel="stylesheet" href="../css/public.css">
    <script src="../js/city.js"></script>
    <script src="../lib/zepto.min.js"></script>
    <script src="../js/frozen.js"></script>
    <script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
    <style type="text/css">
    .ui-userinfo-header{position: relative;font-size: 16px;color: #fff}
    .ui-userinfo-header .ui-setBg{display: block;height: 200px;width: 100%;}
    .ui-userinfo-header .ui-userP{position: absolute;text-align: center;top: 50%;margin-top: -40px;left: 50%;margin-left: -47px;}
    .ui-userP .ui-avatar{display: block;height:80px;width: 80px;}
    .ui-form-item label:not(.ui-switch):not(.ui-checkbox):not(.ui-checkbox-s):not(.ui-radio){width: 80px;}
    .ui-sign-lesson .ui-dialog-cnt{width: 80%;}
    .ui-sign-lesson .ui-dialog-hd{background-color: #fff; margin-bottom: 10px;}
    .ui-sign-lesson .ui-dialog-hd h3{font-weight: 600;font-size: 14px;color: #3d3d3d;background-color:#fff;}
    .ui-sign-lesson .ui-form label,.ui-form-item input{color: #a0a0a0;}
    .ui-sign-lesson .but-wrap {text-align: center;background-color: #fff;padding: 20px 0;}
    .ui-sign-lesson .but-wrap label{color: #7e7e7e;}
    .ui-sign-lesson .but-wrap .ui-btn-primary{width: 150px;margin: 20px auto 10px;height: 35px;line-height: 35px;}
    </style>
</head>

<body ontouchstart>
    <header class="ui-header ui-header-positive ui-border-b">
        <i class="ui-icon-return" onclick="history.back()"></i>
        <h1>个人信息</h1>
    </header>
    <section class="ui-container">
        <div class="demo-block ui-userinfo-header">
            <img class="ui-setBg" src="../img/editorBg.jpg" />
            <div class="ui-userP">
                <span class="ui-avatar ui-userImg"></span>
            </div>
        </div>
        <div class="demo-block ui-sign-lesson">
            
                    <div class="demo-block">
                        <div class="ui-form ui-border-t">
                            <form action="#">
                                <div class="ui-form-item ui-border-b">
                                    <label class="ui-border-r"> 姓名：</label>
                                    <input type="text" id="realname" class="ui-toWd" placeholder="输入您的姓名" />
                                </div>
                                <div class="ui-form-item ui-border-b">
                                    <label class="ui-border-r">性别：</label>
                                    <div style="display:inline-block;padding-left:95px;">
					               	 	<label class="ui-radio" for="radio">男&nbsp;<input type="radio" value="男" name="sex">
				                        </label>
					                    <label class="ui-radio" for="radio">女&nbsp;<input type="radio"  value="女" name="sex"></label>
                                 	</div>
                                    
                                </div>
                                <div class="ui-form-item ui-border-b">
                                    <label class="ui-border-r">职业：</label>
                                    <select style="padding-left:95px;color: #a0a0a0;border: 0;background: none;" id="job">
                                        <option value="0" selected="selected">请选择</option>
                                        <option value="计算机/互联网/通信/电子">计算机/互联网/通信/电子</option>
                                        <option value="销售/客服/技术支持">销售/客服/技术支持</option>
                                        <option value="会计/金融/银行/保险">会计/金融/银行/保险</option>
                                        <option value="生产/营运/采购/物流">生产/营运/采购/物流</option>
                                        <option value="生物/制药/医疗/护理">生物/制药/医疗/护理</option>
                                        <option value="广告/市场/媒体/艺术">广告/市场/媒体/艺术</option>
                                        <option value="建筑/房地产">建筑/房地产</option>
                                        <option value="人事/行政/高级管理">人事/行政/高级管理</option>
                                        <option value="咨询/法律/教育/科研">咨询/法律/教育/科研</option>
                                        <option value="服务业">服务业</option>
                                        <option value="公务员/翻译">公务员/翻译</option>
                                        <option value="其他">其他</option>
                                    </select>
                                </div>
                                <!--  
                                <div class="ui-form-item ui-border-b">
                                    <label class="ui-border-r">年龄：</label>
                                    <input type="text" id="birthday" class="ui-toWd" placeholder="输入您的年龄" />
                                </div>
                                -->
                                <div class="ui-form-item ui-border-b">
                                    <label class="ui-border-r">手机号：</label>
                                    <input type="text" id="mobile" class="ui-thWd" placeholder="输入您的手机号" />
                                </div>
                                <div class="ui-form-item ui-border-b">
                                    <label class="ui-border-r"> 微信号：</label>
                                    <input type="text" id="weixin" readonly="readonly" class="ui-thWd" placeholder="输入您的微信号" />
                                </div>
                                <div class="ui-form-item ui-border-b">
                                    <label class="ui-border-r">微信昵称：</label>
                                    <input type="text" readonly="readonly" id="nickname" class="ui-foWd" placeholder="输入您的微信昵称" />
                                </div>
                                <div class="ui-form-item ui-border-b">
                                    <label class="ui-border-r">所在城市：</label>
                                    <div class="ui-select-group" >
						                <div class="ui-select">
						                    <select id="province"></select>
						                </div>
						                <div class="ui-select">
						                    <select id="city">
						                        <option value="0">请选择</option>
						                    </select>
						                </div>
						            </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="but-wrap">
                        <button class="ui-btn-lg ui-btn-primary" id="btn-submit">保存</button>
                    </div>
                
            
        </div>
    </section>
    <!-- /.ui-container-->
    <script>
    
    Zepto(function($) {
    	
    	BWK.Utils.createProvince($('#province'));
    	
        BWK.Weixin(null,function(){
             $('.ui-userinfo-header').on('tap',function(){
                 wx.chooseImage({
                     count: 1, // 默认9
                     sizeType: ['original', 'compressed'], // 可以指定是原图还是压缩图，默认二者都有
                     sourceType: ['album', 'camera'], // 可以指定来源是相册还是相机，默认二者都有
                     success: function (res) {
                         var localIds = res.localIds; // 返回选定照片的本地ID列表，localId可以作为img标签的src属性显示图片
                         if (localIds) {
                              wx.uploadImage({
                                 localId: localIds[0],
                                 success: function (res) {
                                     //alert(localIds);
                                     dealImg = res.serverId;
                                     _uploadServer(dealImg); 
                                     $('.ui-userImg').css({'background-image':'url('+localIds[0]+')'});   
                                 },
                                 fail: function (res) {
                                   alert(JSON.stringify(res));
                                 }
                              });   
                         }  
                     }
                 });
                 return false;
            });
        });

        $('#btn-submit').click(function(){
            //报名
            var params  = [];
            $('form input[type="text"]').each(function(){
                if($(this).val()){
                    params.push({"name":$(this).attr('id'),"value":$(this).val()});
                }
            });
			params.push({"name":"sex","value":$('input[name="sex"]:checked').val()});
			
			//TODO
			params.push({"name":"job","value":$('#job').val()});
			
		    params.push({"name":"province","value":$('#province').val()});
		   params.push({"name":"city","value":$('#city').val()});
		
			
            BWK.api.user.updateUser(params,function(data){
                BWK.Utils.Tips('信息修改成功！');                
            });

        })
        //查询个人信息
        BWK.api.user.getUser(null,function(data){
            
            _dealInfo(data);
        });

    });
    
    function _uploadServer(dealImg){
        BWK.api.weixin.uploadImage({serverId:dealImg},function(){
            //DONOTHING
        })
    }
    function _dealInfo(obj) {
        $('.ui-userImg').css({'background-image':'url('+obj.headimgurl+')'});  
        $("#realname").val(obj.username);
        $("input[name='sex'][value='"+obj.sex+"']").prop('checked',true);
        $("#participationCount").val(obj.participationCount);
        $("#birthday").val(obj.birthday);
        $("#mobile").val(obj.mobile);
        $("#weixin").val(obj.weixin);
        $("#nickname").val(obj.nickname);
		$("#job").val(obj.job);
 		$('#province').val(obj.province);     
        if(obj.province&&obj.city){
        	BWK.Utils.createCity(cityDict[obj['province']].sub,obj['city']);
        }
    }
    
    
    
    </script>
</body>

</html>
