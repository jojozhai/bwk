<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <title>课程报名</title>
    <link rel="stylesheet" href="../css/frozen.css">
    <link rel="stylesheet" href="../css/public.css">
    <script src="../lib/zepto.min.js"></script>
    <script src="../js/city.js"></script>
    <script src="../js/frozen.js"></script>
    <script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
    <style type="text/css">
    .ui-lesson-header img {display: block;height: 200px;width: 100%;}
    .ui-lesson-header .ui-lesson-headerIntro {text-align: left;background-color: #fff;padding: 10px;}
    .ui-lesson-header h3 {font-size: 18px;margin: 10px 0;}
    .demo-item #desc{color: #a2a2a2;font-size: 12px;margin: 10px;}
    .item-details {background: #fff;margin: 10px 0;padding-bottom: 10px;}
    .item-details img {width: 96%;margin: 10px auto;display: block;}
    .item-details .demo-desc {color: #555;font-size: 14px;}
    .item-details .demo-desc span {margin-right: 10px;color: #000;font-weight: bold;font-size: 14px;}
    .item-text {background-color: #fff;padding-bottom: 40px;overflow:hidden;}
    .item-text .ui-btn-lg {height: 57px;line-height: 57px;border-radius: 0;}
    .ui-form-item label:not(.ui-switch):not(.ui-checkbox):not(.ui-checkbox-s):not(.ui-radio){width: 80px;}
    .ui-sign-lesson .ui-dialog-cnt{width: 80%;}
    .ui-sign-lesson .ui-dialog-hd{background-color: #fff; margin-bottom: 10px;border-radius:5px;-webkit-border-radius:5px;}
    .ui-sign-lesson .ui-dialog-hd h3{font-weight: 600;font-size: 14px;color: #3d3d3d;background-color:#fff;border-radius:5px;-webkit-border-radius:5px;}
    .ui-sign-lesson .ui-form label{color: #424242;}
    .ui-sign-lesson .but-wrap {text-align: center;background-color: #fff;padding: 20px 0;border-radius: 5px;-webkit-border-radius:5px;}
    .ui-sign-lesson .but-wrap label{color: #7e7e7e;font-size:12px;}
    .ui-sign-lesson .but-wrap .ui-btn-primary{width: 150px;font-size:12px;margin: 20px auto 10px;height: 35px;line-height: 35px;}
    .ui-form-item label,.ui-form-item input,.ui-form-item span,.ui-form-item select{font-size:12px;}
    .ui-form-item select option{list-style:none;}
    .ui-user-city input{width:70px;text-align: center;padding:0}
    .ui-user-city .ui-select{margin-right:0;width:50%;}
    #content{padding: 0 10px;position: relative;z-index: 10;}
    #content img{width: 100%;}
    .ui-footer{border-top: 0;}
    .ui-lesson-headerIntro>p{padding:2px 0;}
    </style>
</head>

<body ontouchstart>
    <header class="ui-header ui-header-positive ui-border-b">
        <i class="ui-icon-return" onclick="history.back()"></i>
        <h1>课程报名</h1>
        <a class="ui-btn" href="index.html">回首页</a>
    </header>
    <footer class="ui-footer ui-footer-btn">
        <div class="demo-item item-text">
            <button class="ui-btn-lg ui-btn-primary" id="btn1">立即参加</button>
        </div>
    </footer>
    <section class="ui-container">
        <div class="demo-block ui-lesson-header">
            <img id="image" src="" />
            <div class="ui-lesson-headerIntro">
                <h3><span>主题&nbsp;&nbsp;|&nbsp;&nbsp;</span><span id="name"></span></h3>
                <p>主讲人：<span id="teacher"></span></p>
                <p>课程时间：<span id="startTime"></span></p>
                <p>课程形式：<span id="lessonType"></span></p>
                <p class="lessonAddress" style="display:none;">课程地点：<span id="address"></span></p>
                <p style="color:red;">温馨提示：<span id="tip" style="color:#000;"></span></p>
            </div>
        </div>
        <div class="demo-item item-details">
            <p class="demo-desc"><span>|</span>课程详情</p>
            <div id="content" ></div>
        </div>
        <div class="demo-item item-text">
            <div id="desc"></div>
            <!-- <button class="ui-btn-lg ui-btn-primary" id="btn1">立即参加</button> -->
        </div>

        <div class="demo-block ui-sign-lesson">
            <div class="ui-dialog">
                <div class="ui-dialog-cnt">
                    <header class="ui-dialog-hd">
                        <h3>完善您的报名信息</h3>
                        <i class="ui-dialog-close" data-role="button"></i>
                    </header>
                    <div class="demo-block">
                        <div class="ui-form ui-border-t">
                            <form action="#">
                                <div class="ui-form-item ui-border-b">
                                    <label class="ui-border-r">姓名：</label>
                                    <input type="text" id="realname" class="ui-toWd" placeholder="输入您的姓名" />
                                </div>
                                <div class="ui-form-item ui-border-b">
                                    <label class="ui-border-r"> 性别：</label>
                                    <div style="display:inline-block;padding-left:95px;">
					               	 	<label class="ui-radio" for="radio">男&nbsp;<input type="radio" value="男" name="sex">
				                        </label>
					                    <label class="ui-radio" for="radio">女&nbsp;<input type="radio"  value="女" name="sex"></label>
                                 	</div>
                                </div>
                                <div class="ui-form-item ui-border-b">
                                    <label class="ui-border-r">职业：</label>
                                    <select style="padding-left:95px;color: #a0a0a0;border: 0;background: none;" id="job">
                                        <option value="0" selected="selected">请选择</option>
                                        <option value="计算机/互联网/通信/电子">计算机/互联网/通信/电子</option>
                                        <option value="销售/客服/技术支持">销售/客服/技术支持</option>
                                        <option value="会计/金融/银行/保险">会计/金融/银行/保险</option>
                                        <option value="生产/营运/采购/物流">生产/营运/采购/物流</option>
                                        <option value="生物/制药/医疗/护理">生物/制药/医疗/护理</option>
                                        <option value="广告/市场/媒体/艺术">广告/市场/媒体/艺术</option>
                                        <option value="建筑/房地产">建筑/房地产</option>
                                        <option value="人事/行政/高级管理">人事/行政/高级管理</option>
                                        <option value="咨询/法律/教育/科研">咨询/法律/教育/科研</option>
                                        <option value="服务业">服务业</option>
                                        <option value="公务员/翻译">公务员/翻译</option>
                                        <option value="其他">其他</option>
                                    </select>
                                </div>
                                 <div class="ui-form-item ui-border-b">
                                    <label class="ui-border-r">工作年限：</label>
                                    <div class="ui-select">
			                            <select id="workyear">
			                                <option value="0"  selected="selected">请选择</option>
			                                <option value="学生">学生</option>
			                                <option value="1~3年">1~3年</option>
			                                <option value="3~5年">3~5年</option>
			                                <option value="5~10年">5~10年</option>
			                                <option value="10年以上">10年以上</option>
			                            </select>
			                        </div>
                                </div>
                                <div class="ui-form-item ui-border-b">
                                    <label class="ui-border-r">手机号：</label>
                                    <input type="text" id="mobile" class="ui-thWd" placeholder="输入您的手机号" />
                                </div>
                                <div class="ui-form-item ui-border-b">
                                    <label class="ui-border-r">微信号：</label>
                                    <input type="text" id="weixin" class="ui-thWd" placeholder="输入您的微信号" />
                                </div>
                                <div class="ui-form-item ui-border-b ui-user-city">
			                        <span style="float:left;"> 城市：</span>
			                        <div class="ui-select-group" >
						                <div class="ui-select">
						                    <select id="province"></select>
						                </div>
						                <div class="ui-select">
						                    <select id="city">
						                        <option value="0">请选择</option>
						                    </select>
						                </div>
						            </div>
			                    </div>
                            </form>
                        </div>
                    </div>
                    <div class="but-wrap">
                        <div class="ui-btn-small">
                           <label class="ui-checkbox-s">
                                <input type="radio" name="online" value="1" class="online-off">线上
                            </label>
                            <label class="ui-checkbox-s">
                                <input type="radio" name="online" class="online-off" value="2">线下
                            </label>
                        </div>
                        <button class="ui-btn-lg ui-btn-primary" id="btn-submit">提交</button>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- /.ui-container-->
    <script>
    $('.ui-list li,.ui-tiled li').click(function() {
        if ($(this).data('href')) {
            location.href = $(this).data('href');
        }
    });
    var paramsObj = {};
    var shareObj;
	//TODO 
    Zepto(function($) {
    	BWK.Utils.createProvince($('#province'));
        BWK.Utils.loading.show();
    	BWK.api.lesson.lessonDetail(BWK.UrlParams.id,function(data){
            var dealObj = shareObj = data||{};
            $('#name').text(dealObj.name);
            $('#teacher').text(dealObj.teacherInfo.name);
            $('#startTime').text(BWK.Utils.dateformateLocal(new Date(dealObj.startTime),"yyyy-MM-dd hh:mm"));
            $('#endTime').text(BWK.Utils.dateformateLocal(new Date(dealObj.endTime),"yyyy-MM-dd hh:mm"));
            $('#tip').text(dealObj.tip);
            if(dealObj.online&&!dealObj.offline){
                $(".online-off").eq(1).attr("disabled","true");
                $(".online-off").eq(0).attr("checked","checked");
            }else if(dealObj.offline&&!dealObj.online){
                $(".online-off").eq(0).attr("disabled","true");
                $(".online-off").eq(1).attr("checked","checked");
            }
            
            var lessonType = (dealObj.online?'线上':'') +((dealObj.online&&dealObj.offline)?'/':'')+ (dealObj.offline?'线下':'');
            $('#lessonType').text(lessonType);

            if(dealObj.offline){
                $('.lessonAddress').show();    
                $('#address').text(dealObj.address);
            }

            $('#image').attr('src',dealObj.image);
            $('#content').html(dealObj.content);
            $('#desc').html(dealObj.desc);

            paramsObj.imgUrl = dealObj.image;
            //分享文字
            //BWK.api.lesson.shareText(null,function(data){
               paramsObj.lessonName = dealObj.shareTitle;
               paramsObj.desc = dealObj.shareTip;
               //BWK.WeixinShare(paramsObj);  
            //}); 
           
            BWK.api.user.getUser(null,function(data){                
            	var url = location.href.substring(0,location.href.indexOf('?')+1)+'id='+BWK.UrlParams.id+'&sharerId='+data.id;
            	paramsObj.shareUrl = url;
                BWK.WeixinShare(paramsObj);                          
            });
           
        }); 
    	
        
    	$("#btn1").click(function(){
    		 if(shareObj.shareSign){
             	BWK.Utils.dialogAlert(shareObj.shareSignTip);
             	return false;
             }
            $(".ui-dialog").dialog("show");
        })
        $('#btn-submit').click(function(){
           
            //报名
            var flag = true;
            var params  = [];
            $('form input[type="text"],form select').each(function(){
                if($(this).val()){
                    params.push({"name":$(this).attr('id'),"value":$(this).val()});
                }else{
                	flag = false;
                }
            });
            if(!flag|| $('#job').val()==0 || $('#workyear').val()==0 || $('#province').val()==0){
            	BWK.Utils.dialogAlert("你好，请完善所有信息后再报名！");
            	return false;
            }
			params.push({"name":"sex","value":$('input[name="sex"]:checked').val()});
			//TODO
			//params.push({"name":"job","value":$('#job').val()});
		    //params.push({"name":"province","value":$('#province').val()});
		    //params.push({"name":"city","value":$('#city').val()});
		    //params.push({"name":"workyear","value":$('#workyear').val()});
            BWK.api.user.updateUser(params,function(data){
                var online = $('input[type="radio"]:checked').val()==1?true:false; 
                BWK.api.lesson.lessonSign({"lessonId":BWK.UrlParams.id,"online":online},function(data){
                    $(".ui-dialog").dialog("hide"); 
                    BWK.Utils.Tips('已报名成功！');

                    //成为上下级关系
                    if(BWK.UrlParams.sharerId){
                        BWK.api.lesson.lessonReportShare({sharerId:BWK.UrlParams.sharerId},function(data){
                            //TODO
                        });    
                    }

                });
            });

        })
        //查询个人信息
        BWK.api.user.getUser(null,function(data){
        	for(var i in data){
        		$('#'+i).val(data[i]);
        	}
        	$("input[name='sex'][value='"+data.sex+"']").prop('checked',true);
        	 if(data.province&&data.city){
             	BWK.Utils.createCity(cityDict[data['province']].sub,data['city']);
             }
        });
        


    });

    function _dealImgList(obj) {



    }
    </script>
</body>

</html>
