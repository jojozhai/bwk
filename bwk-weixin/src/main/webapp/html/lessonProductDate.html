<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <title>留言预约</title>
    <link rel="stylesheet" href="../css/frozen.css">
    <link rel="stylesheet" href="../css/public.css">
    <script src="../lib/zepto.min.js"></script>
    <script src="../js/city.js"></script>
    <script src="../js/frozen.js"></script>
    <script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
    <style type="text/css">
    .ui-list li h4,.ui-list-info #teacherName{color: #4f4f4f;}
    .ui-list-info .ui-nowrap span{font-size:12px;color:#acacac;}
    .ui-txt-right{float:right;line-height: 14px;}
    #teacherIntro{float: left;width:100px;overflow: hidden;white-space: nowrap;text-overflow: ellipsis;}
    #courseMoney{margin-right:16px;}
    .ui-form-item lable,.ui-form-item input{color:#424242;}
    /* .ui-form-item input{border:1px solid #eee;padding:4px;}
    .ui-form-item #realname{margin-left: 66px;width: 120px;}
    .ui-form-item #mobile{margin-left: 66px;width: 160px;}
   */  
    .ui-teacherAd .ui-avatar{width:60px;height:60px;}
    .ui-teacherAd,.demo-massage{margin:10px;background: #fff;}
    .ui-user-city input{width:78px;text-align: center;}
    .ui-masssage-cont{display: block;width: 100%;resize:none;border-radius: 2px;border-radius: 2px;height: 200px;overflow-y: scroll;margin-bottom: 20px;
        text-indent: 1em;line-height: 30px;color: #999;}
    </style>
</head>

<body ontouchstart>
    <section class="ui-container">
        <div class="demo-item ui-teacherAd">
            <ul class="ui-list">
                <li>
                    <div class="ui-avatar">
                        <span id="teacherImg"></span>
                    </div>
                    <div class="ui-list-info">
                        <h4 class="ui-nowrap" id="name"></h4>
                        <p class="ui-nowrap ui-teacher-name">
                            <span id="teacherName"></span>
                        </p>
                        <div class="ui-nowrap"><span id="teacherIntro" class="teacher-honour"></span><div class="ui-txt-right"><span id="courseMoney"></span><span id="dataNum"></span></div></div>
                    </div>
                </li>
            </ul>
        </div>
        <div class="demo-block">
            <div class="ui-form ui-border-t">
                <form action="#">
                    <div class="ui-form-item ui-border-b">
                        <label>姓名：</label>
                        <input type="text" id="realname" placeholder="输入您的姓名" />
                    </div>
                    <div class="ui-form-item ui-border-b">
                        <label> 手机：</label>
                        <input type="text" id="mobile" placeholder="输入您的手机号" />
                    </div>
                    <div class="ui-form-item ui-border-b">
                        <label> 微信号：</label>
                        <input type="text" id="weixin" placeholder="输入您的微信号" />
                    </div>
                    <div class="ui-form-item ui-border-b">
                        <label> 收货地址：</label>
                        <input type="text" id="address" placeholder="输入您的收货地址" />
                    </div>
                    <!-- <div class="ui-form-item ui-border-b ui-user-city">
                        <span style="float:left;"> 城市：</span>
                        <div class="ui-select-group" style="margin-left:64px;">
						     <div class="ui-select">
						          <select id="province"></select>
						     </div>
						     <div class="ui-select">
						          <select id="city">
						             <option value="0">请选择</option>
						          </select>
						     </div>
						</div>
                    </div> -->
                </form>
            </div>
        </div>
        <div class="demo-massage">
            <!-- <textarea class="ui-masssage-cont">请在500字以内 描述你想咨询的问题</textarea> -->
            <button class="ui-btn-lg ui-btn-primary" id="btnApply">提交</button>
        </div>
    </section>
    
    <!-- /.ui-container-->
    <script>
    $('.ui-list li,.ui-tiled li').click(function() {
        if ($(this).data('href')) {
            location.href = $(this).data('href');
        }
    });
    var sharerId,payObj;
    var productObj;
    Zepto(function($) {
    	//BWK.Utils.createProvince($('#province'));
        //问题输入
        $(".ui-masssage-cont").click(function(){
            if($(this).html()=="请在500字以内 描述你想咨询的问题"){
                $(this).html("");
            };
        })

        BWK.api.lesson.lessonProdectDetail(BWK.UrlParams.id,function(data){
        	productObj = data;
            $('#teacherImg').css({'background-image':'url('+data.lessonInfo.teacherInfo.image+')'});
            $('#name').text(data.name);
            $('#teacherName').text(data.lessonInfo.teacherInfo.name);
            $('#teacherIntro').text(data.lessonInfo.teacherInfo.title);
            $('#dataNum').text((data.saleCountPlus+data.saleCount)+"人约见");
            $('#courseMoney').text("￥"+data.price);
        });

        BWK.api.user.getUser(null,function(data){
             
            $('#realname').val(data.realname);
            $('#mobile').val(data.mobile);
            $('#weixin').val(data.weixin);
            //$('#province').val(data.province||"0");
            $('#address').val(data.address);
            /*$('#city').val(data.city); */
            /* if(data.province&&data.city){
             	BWK.Utils.createCity(cityDict[data['province']].sub,data['city']);
             } */

        });

        var params = {"cartInfos":[{"productId":BWK.UrlParams.id,"count":1}],"message":''};
        if(window.localStorage){
            sharerId = window.localStorage.getItem('sharerId');
            if(sharerId){
                params.sharerId = sharerId;
            }
        } 
        $('#btnApply').click(function(){
        	
        	if(productObj){
				if(productObj.requireName && !$('#realname').val()){
					BWK.Utils.dialogAlert('你好，为方便联系，请留下您的姓名！');
					return false;
        		}
				if(productObj.requirePhone && !$('#mobile').val()){
					BWK.Utils.dialogAlert('你好，为方便联系，请留下您的手机号！');
					return false;
        		}
				if(productObj.requireWeixin && !$('#weixin').val()){
					BWK.Utils.dialogAlert('你好，为方便联系，请留下您的微信号！');
					return false;
        		}
        		if(productObj.requireAddress && !$('#address').val()){
        			BWK.Utils.dialogAlert('你好，为方便联系，请留下您的地址！');
					return false;
        		}
        	}
        	
            BWK.Utils.loading.show();
            //预约购买商品
            BWK.api.lesson.lessonProdectBuy(params,function(data){
                payObj = data['data'];
                BWK.Weixin({},function(){
                    wx.chooseWXPay({
                        timestamp: payObj.timeStamp, 
                        nonceStr: payObj.nonceStr, 
                        package: payObj.package, 
                        signType: payObj.signType,
                        paySign: payObj.paySign, 
                        success: function (res) {
                            // 支付成功后的回调函数
                            BWK.Utils.dialogAlert('已完成支付，点击关闭将跳到我的预约页面！',function(){
                                window.location.href = 'myQuestion.html';
                            })
                        }
                    });
                });

                var params  = [];
                $('form input[type="text"]').each(function(){
                    if($(this).val()){
                        params.push({"name":$(this).attr('id'),"value":$(this).val()});
                    }
                });
    			
    		    //params.push({"name":"province","value":$('#province').val()});
    		    //params.push({"name":"city","value":$('#city').val()});
                BWK.api.user.updateUser(params,function(data){
                
                });

            });
        });
        
        
    });

    function _dealImgList(obj) {



    }
    </script>
</body>

</html>
