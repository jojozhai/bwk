<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
        <meta name="format-detection" content="telephone=no">
        <title>课程分类</title>
        <link rel="stylesheet" href="../css/frozen.css">
        <link rel="stylesheet" href="../css/public.css">
        <script src="../lib/zepto.min.js"></script>
        <script src="../js/frozen.js"></script>
        <style type="text/css">
            .ui-row-flex{background-color: #fff;}
            .ui-row-flex .ui-col{background: none;border: none;}
            .ui-row-flex .ui-col h5{font-size: 12px;color: #9e9e9e;}           
            .ui-container .ui-item-list{margin: 10px 0;display:none;}
            .ui-container .ui-item-list.list_current{display:block;}
            .ui-container .ui-item-list .ui-list-info{padding-left:30px;}
            .ui-container .ui-item-list .ui-less-title{font-size: 14px;color: #5f5f5f;}   
            .ui-container .ui-item-list .ui-less-desc{font-size: 12px;color: #bbb;margin-top:26px;}
            .ui-container .ui-item-list .ui-list-img span{border-radius: 5px;-webkit-border-radius:5px;-moz-border-radius:5px;}
        </style>
    </head>
    
    <body ontouchstart>
        <!-- <header class="ui-header ui-header-positive ui-border-b">
            <h1>课程分类</h1>
        </header> -->
        <footer class="ui-footer ui-footer-btn">
            <ul class="ui-tiled ui-border-t">
                <li data-href="lessonTypes.html" >
                    <div class="ui-title-img"><img src="../img/footerTypeSel.png"  /></div>
                    <div class="ui-title-name ui-menu-current">课程视频</div>
                </li>
                <li data-href="lessonQuestion.html" >
                    <div class="ui-title-img"><img src="../img/footerTeacher.png"  /></div>
                    <div class="ui-title-name">咨询老师</div>
                </li>
                <li data-href="index.html" class="ui-menu-index">
                    <div class="ui-title-img"><img src="../img/menuIndex.png"  /></div>
                </li>
                <li data-href="lessonMoney.html">
                    <div class="ui-title-img ui-img-money"><img src="../img/footerMoney.png"  /></div>
                    <div class="ui-title-name">奖学金</div>
                </li>
                <li data-href="userCenter.html">
                    <div class="ui-title-img"><img src="../img/footerUser.png"  /></div>
                    <div class="ui-title-name">个人中心</div>
                </li>
            </ul>
        </footer>
        <section class="ui-container">
           <section class="ui-input-wrap">
                <div class="ui-input ui-border-radius">
                    <input type="text" id="searchPro" name="" value="" placeholder="查询课程或老师名字" />
                </div>
                <span class="ui-btn-search"></span>
            </section>
            <div class="ui-lessonType">
                <div class="ui-row-flex">
                    <div class="ui-col active">
                        <div><span class="lessonType lessonType1"></span></div>
                        <h5>职场提升</h5>
                    </div>
                    <div class="ui-col">
                        <div><span class="lessonType lessonType2"></span></div>
                        <h5>创新营销</h5>
                    </div>
                    <div class="ui-col">
                        <div><span class="lessonType lessonType3"></span></div>
                        <h5>创业之路</h5>
                    </div>
                    <div class="ui-col">
                        <div><span class="lessonType lessonType4"></span></div>
                        <h5>个人提升</h5>
                    </div>
                    <div class="ui-col">
                        <div><span class="lessonType lessonType5"></span></div>
                        <h5>兴趣爱好</h5>
                    </div>
                </div>
                
            </div>
            
            <div class="demo-block ui-item-list list_current">
                
                <ul class="ui-list ui-list-link ui-border-tb">
                   <!--  
                   <li class="ui-border-t">
                        <div class="ui-list-img">
                            <span style="background-image:url(http://placeholder.qiniudn.com/200x136)"></span>
                        </div>
                        <div class="ui-list-info">
                            <h4 class="ui-nowrap ui-less-title">职场提升系列</h4>
                            <p class="ui-nowrap ui-less-desc">老师:  高兴</p>
                        </div>
                    </li>
                    <li class="ui-border-t">
                        <div class="ui-list-img">
                            <span style="background-image:url(http://placeholder.qiniudn.com/200x136)"></span>
                        </div>
                        <div class="ui-list-info">
                            <h4 class="ui-nowrap ui-less-title">职场提升系列</h4>
                            <p class="ui-nowrap ui-less-desc">老师:  高兴</p>
                        </div>
                    </li> 
                    -->
                </ul>
                <!-- 下拉加载提示 -->
                <div class="ui-loading-wrap" style="display:none;">
                    <p>下拉加载</p>
                    <i class="ui-loading" style="display:none;"></i>
                </div>
            </div>
                            

        </section><!-- /.ui-container-->
        <script>
        

        var params = {'enable':true,'herald':false,'typeId':BWK.UrlParams.id,page:0,size:6,top:false,'sort':'createdTime,asc'};
        var pageNum = 0;
        Zepto(function($){
            $('.ui-list li,.ui-tiled li').tap(function(){
                if($(this).data('href')){
                    location.href= $(this).data('href');
                }
            });

            BWK.api.lesson.lessonType(null,function(data){
                var dealObj = data.children||[];
                for(var i=0;i<dealObj.length;i++){
                    $('.ui-lessonType .ui-col').eq(i).attr('id',dealObj[i].id);
                    if(BWK.UrlParams.id&&BWK.UrlParams.id == dealObj[i].id){
                        $('.ui-lessonType .active').removeClass('active');
                        $('.ui-lessonType .ui-col').eq(i).addClass('active');
                    }
                }
               params.typeId = $('.ui-lessonType .ui-col').eq(0).attr('id');
               
               BWK.api.lesson.lesson({'enable':true,'herald':false,'typeId':params.typeId,top:true},function(data){
                   var dealObj = data.content||[]; 
                   _dealList(dealObj,true);
                   initReq(true,false);   
               }); 
               
            });
            
            $('.ui-lessonType').on('click','.ui-col',function(){
                 $('.ui-lessonType .active').removeClass('active');
                  $(this).addClass('active');
                  if(params.name){
                	  params.name = null;
                  }
                //分页查询TODO
               params.typeId = $(this).attr('id');
               
               BWK.api.lesson.lesson({'enable':true,'herald':false,'typeId':params.typeId,top:true},function(data){
                   var dealObj = data.content||[]; 
                   _dealList(dealObj,true);
                   initReq(true,false);   
               }); 

            });
			
            $('#searchPro').on('keyup',function(){
                BWK.api.lesson.lesson({'enable':true,'herald':false,page:0,size:10,'sort':'createdTime,asc','keywords':$.trim($(this).val())},function(data){
                    var dealObj = data.content||[]; 
                    _dealList(dealObj,true);               
                });  
            });
     
            $('.ui-list-link').on('click','li',function(){
                location.href = "lessonContents.html?id="+$(this).attr('id');
            });

        });

       function initReq(flag,isRefresh){
            $(window).unbind('scroll');
            if(!flag){
                params.page = pageNum;
                _dealLoading('loading');
            }else{
                BWK.Utils.loading.show();
                pageNum = 0;
                params.page = 0;
            }      

            BWK.api.lesson.lesson(params,function(data){
                var dealObj = data.content||[]; 
                if(flag){
                    BWK.Utils.loading.hide();
                }
                _dealList(dealObj,isRefresh);
                if(data.totalPages<2){
                    $('.ui-loading-wrap').hide();
                }else{
                    if(data.totalPages == data.number+1){
                        _dealLoading('end');
                    }else{
                        _dealLoading('start');
                        $(window).bind('scroll',function () { dealPullReq(); });
                    }
                    
                }
            }); 

        }
        function dealPullReq(){
            var scrollTop = document.body.scrollTop;//滚轮高度
            var windowHeight = $(window).height();  //浏览器显示区域高度
            var wholeHeight=document.body.scrollHeight;
            if (scrollTop + windowHeight == wholeHeight) {
                //加载条
                pageNum += 1;                   
                initReq(false);  
            }
        }
        function _dealLoading(type){
            $('.ui-loading-wrap').show();
            if(type=='start'){
                $('.ui-loading-wrap p').text('下拉刷新');
                $('.ui-loading-wrap .ui-loading').hide();
            }else if(type=="end"){
                $('.ui-loading-wrap p').text('亲！已经到底了');
                //$('.ui-loading-wrap p').addClass('nomore');
                $('.ui-loading-wrap .ui-loading').hide();
            }else if(type="loading"){
                $('.ui-loading-wrap p').text('正在加载中。。。');
                $('.ui-loading-wrap .ui-loading').show();
            }   
        }
        
        function _dealList(dealObj,isRefresh){
            if(isRefresh){
                $('.ui-list-link').empty();
            }
            var str = '';
            if(dealObj.length==0&&isRefresh){
                $('.ui-list-link').append('<section class="ui-notice"><i></i><p>暂无分类课程</p></section>');
            }else{
                for(var i =0;i<dealObj.length;i++){
                    str += '<li class="ui-border-t" id="'+dealObj[i].id+'"><div class="ui-list-img"><span style="background-image:url('+dealObj[i].image+')"></span></div>';
                    str += '<div class="ui-list-info"><h4 class="ui-nowrap ui-less-title">'+dealObj[i].name+'</h4><p class="ui-nowrap ui-less-desc">老师:'+dealObj[i].teacherName+'</p></div></li>';
                }
                $('.ui-list-link').append(str);
            }
        }
        </script>
    </body>
</html>
