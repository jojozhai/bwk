<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <title>老师商品介绍</title>
    <link rel="stylesheet" href="../css/frozen.css">
    <link rel="stylesheet" href="../css/public.css">
    <script src="../lib/zepto.min.js"></script>
    <script src="../js/frozen.js"></script>
    <script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
    <style type="text/css">
    .ui-video img {display: block;width: 100%;height: 200px;}
    .ui-course-brief {padding:0 10px;background: #fff;}
    .ui-course-brief h3 {border-bottom: 1px solid #e0e0e0;height: 50px;line-height: 50px;}
    .ui-course-brief h3 a {float: right;color:#afafaf;}
    .ui-course-brief h3 a img{width: 18px;padding-left: 4px;}
    .item-discuss,.ui-course-pay{border-top: 1px solid #e0e0e0;}
    .ui-details-cont{margin-bottom: 10px;}
    .ui-course-lists p {padding: 10px;font-size: 14px;color:#afafaf;}
    .ui-icon-unfold{float: right;line-height: 50px;}
    .ui-icon-fold{transform: rotate(180deg);-webkit-transform:rotate(180deg);}
    .ui-avatar-lg{margin:0 auto;}

    .ui-course-lists p img {
        display: block;
        margin-right: 10px;
        float: left;
        width:16px;
    }
    
    .ui-about-teacher {
        padding: 20px 10px;
    }
    
    .ui-teacher-pic {
        text-align: center;
        font-size:18px;
    }
    .ui-teacher-pic p{
         color:#010101;
         margin:8px 0 16px;
    }
    
    .ui-teacher-pic img {
        display: block;
        margin: 0 auto;
        border-radius: 50%;
        height: 80px;
        width: 80px;
    }
    
    .teacher-brief{
        padding: 0 10px;
        color:#b0b0b0;
    }
    .teacher-details p{
        text-indent: 0;
    }
    
    .teacher-brief .view-more,.item-discuss .view-more{
        display: block;
        padding: 20px;
        width: 120px;
        margin: 0 auto;
    }
    .teacher-brief .view-more img,.item-discuss .view-more img{
        float:right;
        width: 9px;
    }
    .ui-list>li {
        margin-left: 0;
        padding-left: 15px;
    }
    
    .item-discuss .ui-list-info .ui-txt-info {
        color: #999;
    }
    
    .ui-list-thumb span {
        border-radius: 50%;
    }
    
    .ui-add-discuss .ui-btn,.ui-course-pay .ui-btn{
        background: #4cbdff;
        color: #fff;
        float: right;
    }
    .ui-add-discuss .ui-btn{
        border-radius: 16px;
    }
    .ui-course-pay{
        padding:10px;
        line-height: 30px;
    }
    .ui-btn:before,
    .ui-btn-lg:before,
    .ui-btn-s:before {
        border: none;
    }
    .share-tip{
        text-align: center;
        color: #00a5e0;
        padding: 10px;
        font-size: 14px;
    }
    .ui-footer{border-top:1px solid #c2c2c2;}
    </style>
</head>

<body ontouchstart>
    
    <footer class="ui-footer ui-footer-btn">
        <div class="demo-block ui-course-pay">
            <span class="ui-course-rmb" id="productPrice"></span>
            <button class="ui-btn ui-btn-toBuy" id="paysure">立即购买</button>
        </div>
    </footer>

    

    <section class="ui-container">
        <div class="ui-video">
            <img src="http://placeholder.qiniudn.com/640x200">
        </div>
        <div class="demo-block">
                <div class="ui-course-brief">
                    <h3 class="ui-course-title">
                        <span id="name"></span>
                        <i class="ui-icon-unfold ui-icon-fold"></i>
                        <a href="javascript:;">收起</a>
                    </h3>
                    <div class="ui-course-lists ui-relation-course" style="overflow:hidden;">
                        <!-- <p><img src="../img/trangle0.png">如何让你的PPT瞬间高大上</p>
                        <p><img src="../img/trangle0.png">职场小白最应该学的3种方法</p> -->
                    </div>
                    <div class="ui-course-lists ui-border-t">
                        <p id="intro"></p>
                        <h3>
                            <span id="price"></span>
                            <a href="javascript:;" id="saleCountPlus"></a>
                        </h3>
                    </div>
                </div>
            </div>
            <div class="demo-block">
                <div class="ui-details-cont">
                    <p class="ui-about-teacher">内容详情：</p>
                    <div class="teacher-brief teacher-details " id="product-details"></div>
                    <div class="teacher-brief"><a class="view-more">展开显示更多<img src="../img/arrowb.png"/></a></div>
                </div>
            </div>
            <div class="demo-block">
                <div class="ui-brief-cont">
                    <p class="ui-about-teacher">关于老师：</p>
                    <div class="ui-teacher-pic">
                         <div class="ui-avatar-lg">
                            <span id="teacherImg" style="background-image:url(http://placeholder.qiniudn.com/140x140)"></span>
                        </div>
                        <p id="teacherName"></p>
                    </div>
                    <div class="teacher-brief" id="teacherDesc"></div>
                    <div class="teacher-brief"><a class="view-more">展开显示更多<img src="../img/arrowb.png"/></a></div>
                    
                    
                    <div class="demo-item item-discuss">
                        <p class="demo-desc" id="commentLength"></p>
                        <div class="demo-block">
                            <ul class="ui-list ui-list-one ui-list-comments">
                                <!-- <li>
                                    <div class="ui-list-thumb">
                                        <span style="background-image:url(http://placeholder.qiniudn.com/100x100)"></span>
                                    </div>
                                    <div class="ui-list-info">
                                        <h4 class="ui-nowrap">晴天AM-S</h4>
                                        <div class="ui-txt-info">2016-9-10</div>
                                    </div>
                                </li>
                                <li>这次我觉得真是没有白来啊</li>
                                --> 
                            </ul>
                        </div>
                    </div>

                </div>
            </div>
    </section>
    <!-- /.ui-container-->
    <script>
    
    $('.ui-list li,.ui-tiled li').click(function() {
        if ($(this).data('href')) {
            location.href = $(this).data('href');
        }
    });

    Zepto(function($) {

        var productObj,currentUserId;
        _initEvent();
        //商品详情
        BWK.api.lesson.lessonProdectDetail(BWK.UrlParams.id,function(data){
            
            productObj = data;
            //展示
            _dealProduct(data);
            //相关课  enable=true&teacherId=1023
            var teacherId = data.lessonInfo.teacherInfo.id;
            BWK.api.lesson.lesson({'enable':true,teacherId:teacherId},function(data){
                var dealLessons = data.content || [];
                var str = '';
                for (var i = 0; i < dealLessons.length; i++) {
                    var obj = dealLessons[i];
                    if(obj.id!=BWK.UrlParams.id){
                        str += '<p id="'+obj.id+'"><img src="../img/trangle0.png">'+obj.name+'</p>';
                    }
                };
                $('.ui-relation-course').append(str);
                $('.ui-relation-course p').tap(function(){
                    location.href = "lessonContents.html?id="+$(this).attr('id');
                });
            });
            
            BWK.api.user.getUser(null,function(data){
                // var paramsObj = {'lessonName':'test','shareUrl':location.href+'&shareId='+data.id};
                // if(productObj.key){
                //     BWK.WeixinShare(paramsObj,function(){
                //         var shareObj = {'goodsId':BWK.UrlParams.id};
                //         if(BWK.UrlParams.shareId){
                //             shareObj.shareId = BWK.UrlParams.shareId;
                //         }
                //         BWK.api.weixin.dealShare(shareObj,function(){
                            
                //         });
                //     });    
                // }else{
                //    BWK.WeixinShare(paramsObj);    
                // }
                
            });
        }); 

        _getCommentsList();
        
        //发表评论
        // var params = {"target": "lesson", "targetId": 1028, "content": "xxx"};
        // BWK.api.lesson.lessonCommentSub(params,function(data){
        //     var dealObj = data.content||[];
        //     _dealImgList(dealObj);
        // });
       
       //显示更多
       $(".view-more").click(function(){
           var listCont=$(this).siblings().eq(1);
           if(!listCont.hasClass("ui-heightAuto")){
               listCont.addClass("ui-heightAuto");
           }else{
               listCont.removeClass("ui-heightAuto");
           }
        })


    });
    
    function _initEvent(){

         $('.ui-course-title').tap(function(){
            var $fold = $(this).find('.ui-icon-fold');
            var $unfold = $(this).find('.ui-icon-unfold');
            if($fold.length>0){
                $fold.removeClass('ui-icon-fold');
                $('.ui-relation-course').height(0);
                $(this).find('a').text('展开');
                $(this).css({'border-bottom':'none'});
            }else{
                $unfold.addClass('ui-icon-fold');
                $('.ui-relation-course').css({'height':'auto'});
                $(this).find('a').text('收起');
                $(this).css({'border-bottom':'1px solid #e0e0e0'});
            }
        }); 

        $('.ui-btn-toBuy').click(function(){
            location.href = 'lessonProductDate.html?id='+BWK.UrlParams.id;
        })

    }

    function _dealProduct(obj){
        $('#name').text(obj.name);
        $('#intro').text(obj.intro);
        $('#price').text('￥'+obj.price+'元/次');
        $('#saleCountPlus').text(obj.saleCountPlus+'人已购买');
        $('#product-details').html(obj.desc);
        $('#teacherImg').attr('src',obj.lessonInfo.teacherInfo.image);
        $('#teacherName').text(obj.lessonInfo.teacherInfo.name);
        $('#teacherDesc').html(obj.lessonInfo.teacherInfo.desc);
        $('#productPrice').text('￥'+obj.price+'元/次')  
    }

    //查询课程评论
    function _getCommentsList(){
       
        BWK.api.lesson.lessonCommentQuery({'target':'product','targetId':BWK.UrlParams.id},function(data){
            var dealObj = data.content||[];
            $('#commentLength').text('评论（'+dealObj.length+'）');
            _dealComments(dealObj);
        });
    }
    function _dealComments(commentList){
        $('.ui-list-comments').empty();
        var str = "";
        if(commentList.length>0){
            for (var i = 0; i < commentList.length; i++) {
                var commentObj = commentList[i];
                str += '<li><div class="ui-list-thumb"><span style="background-image:url('+commentObj.createrHeadimgurl+')"></span></div>';
                str += '<div class="ui-list-info"><h4 class="ui-nowrap">'+commentObj.createrName+'</h4><div class="ui-txt-info">'+BWK.Utils.dateformateLocal(new Date(commentObj.createdTime),'yyyy-MM-dd hh:mm:ss')+'</div></div></li>';
                str += '<li class="ui-border-b">'+commentObj.content+'</li>';
            };
            
        }else{
            str += '<li><p style="text-align:center;width:100%;">暂无评论</p></li>';
        }
        $('.ui-list-comments').append(str);
    }
    </script>
</body>

</html>
