<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <title>咨询老师</title>
    <link rel="stylesheet" href="../css/frozen.css">
    <link rel="stylesheet" href="../css/public.css">
    <script src="../lib/zepto.min.js"></script>
    <script src="../js/frozen.js"></script>
    <style type="text/css">
    .ui-tab-content {margin-top: 0;}
    .demo-block.ui-myadvice {margin: 10px;background: none;}
    .demo-block.ui-myadvice .ui-input-wrap{background: none;margin-bottom: 10px;position: relative;}
    .demo-block.ui-myadvice .ui-input-wrap .ui-input{margin:0;height: 40px;line-height: 40px;font-size: 14px;}
    .ui-input-wrap .ui-btn-search{background-image: url(../img/searchB.png);width: 34px;position: absolute;right: 22px;top: 15px;}
    .demo-block.ui-myadvice .ui-avatar{height:70px;width: 70px;}
    .ui-myadvice  .ui-list>li {margin-left: 0;padding: 5px;}
    .demo-block.ui-myadvice .ui-list{background: #f6f6f6;}
    .demo-block.ui-myadvice .ui-list li{margin-bottom: 10px;background: #fff;}
    .ui-myadvice .ui-list-info h4,.ui-list-info .ui-teacher-name{color:#333;}
    .ui-myadvice .ui-teacher-name{height: 30px;line-height: 30px;}
    .ui-teacher-name .teacher-honour{margin-left:10px;}
    .teacher-honour{padding-left: 16px;}
    .ystars,.gstars,.ui-btn-search{width: 14px;height: 14px;float: right;display: inline-block;background-size: cover;background-repeat: no-repeat;background-position: center center; }
    .ystars{background-image:url(../img/ystar.png);}
    .gstars{background-image:url(../img/gstar.png);}
    </style>
</head>

<body ontouchstart>
     <footer class="ui-footer ui-footer-btn">
            <ul class="ui-tiled ui-border-t">
                <li data-href="lessonTypes.html" >
                    <div class="ui-title-img"><img src="../img/footerType.png"  /></div>
                    <div class="ui-title-name ">课程视频</div>
                </li>
                <li data-href="lessonQuestion.html" >
                    <div class="ui-title-img"><img src="../img/footerTeacherSel.png"  /></div>
                    <div class="ui-title-name ui-menu-current">咨询老师</div>
                </li>
                <li data-href="index.html" class="ui-menu-index">
                    <div class="ui-title-img"><img src="../img/menuIndex.png"  /></div>
                </li>
                <li data-href="lessonMoney.html">
                    <div class="ui-title-img ui-img-money"><img src="../img/footerMoney.png"  /></div>
                    <div class="ui-title-name">奖学金</div>
                </li>
                <li data-href="userCenter.html">
                    <div class="ui-title-img"><img src="../img/footerUser.png"  /></div>
                    <div class="ui-title-name">个人中心</div>
                </li>
            </ul>
        </footer>
    <section class="ui-container">
        <div class="demo-block ui-myadvice">
            <section class="ui-input-wrap">
                <div class="ui-input ui-border-radius">
                    <input type="text" id="searchPro" name="" value="" placeholder="输入问题关键词" />
                </div>
                <span class="ui-btn-search"></span>
            </section>
            <ul class="ui-list ui-list-product">
                <!-- <li>
                    <div class="ui-avatar">
                        <span style="background-image:url(http://placeholder.qiniudn.com/100x100)"></span>
                    </div>
                    <div class="ui-list-info">
                        <h4 class="ui-nowrap">远程：高数老不回怎么办，点击看看</h4>
                        <p class="ui-nowrap ui-teacher-name"><span>OIHIOD</span><span class="teacher-honour">北京大学博士</span></p>
                        <p class="ui-nowrap">652484约见<span class="ystars"></span><span class="ystars"></span><span class="ystars"></span><span class="ystars"></span><span class="ystars"></span></p>
                    </div>
                </li> -->
            </ul>
            <div class="ui-loading-wrap" style="display:none;">
                <p>下拉加载</p>
                <i class="ui-loading" style="display:none;"></i>
            </div>
        </div>
    </section>
    <!-- /.ui-container-->
    <script>
    

    var params = {'enable':true,'page':0,'size':5,'sort':'sort,asc'};
    var pageNum = 0;
    Zepto(function($) {
        $('.ui-tiled li').tap(function() {
            if ($(this).data('href')) {
                location.href = $(this).data('href');
            }
        });
        
        initReq(true,true);

        $('#searchPro').on('keyup',function(){
            params.page = 0;
            pageNum = 0;
            params.name = $.trim($(this).val());
            initReq(false,true);
        });

    });
    

    function initReq(flag,isRefresh){
        $(window).unbind('scroll');
        if(!flag){
            params.page = pageNum;
            _dealLoading('loading');
        }else{
            BWK.Utils.loading.show();
            pageNum = 0;
            params.page = 0;
        }      

        BWK.api.lesson.lessonProdectList(params,function(data){
            var dealObj = data.content||[]; 
            _dealQuestions(dealObj,isRefresh);
            BWK.Utils.loading.hide();
            if(data.totalPages<2){
                $('.ui-loading-wrap').hide();
            }else{
                if(data.totalPages == data.number+1){
                    _dealLoading('end');
                }else{
                    _dealLoading('start');
                    $(window).bind('scroll',function () { dealPullReq(); });
                }
                
            }
        }); 

    }
    function dealPullReq(){
        var scrollTop = document.body.scrollTop;//滚轮高度
        var windowHeight = $(window).height();  //浏览器显示区域高度
        var wholeHeight=document.body.scrollHeight;
        if (scrollTop + windowHeight == wholeHeight) {
            //加载条
            pageNum += 1;                   
            initReq(false);  
        }
    }
    function _dealLoading(type){
        $('.ui-loading-wrap').show();
        if(type=='start'){
            $('.ui-loading-wrap p').text('下拉刷新');
            $('.ui-loading-wrap .ui-loading').hide();
        }else if(type=="end"){
            $('.ui-loading-wrap p').text('亲！已经到底了');
            //$('.ui-loading-wrap p').addClass('nomore');
            $('.ui-loading-wrap .ui-loading').hide();
        }else if(type="loading"){
            $('.ui-loading-wrap p').text('正在加载中。。。');
            $('.ui-loading-wrap .ui-loading').show();
        }   
    }

    function _dealQuestions(obj,isRefresh){
    	var str = "";
        if(isRefresh){
            $('.ui-list-product').empty();
        }
        if(obj&&obj.length>0){
            for(var i=0;i<obj.length;i++){
            	str += '<li id="'+obj[i].id+'"><div class="ui-avatar"><span style="background-image:url('+obj[i].lessonInfo.teacherInfo.image+')"></span></div><div class="ui-list-info">';

            	str += '<h4 class="ui-nowrap">'+obj[i].name+'</h4><p class="ui-nowrap ui-teacher-name"><span>'+obj[i].lessonInfo.teacherInfo.name+'</span><span class="teacher-honour">'+obj[i].intro+'</span></p>';
            	str += '<p class="ui-nowrap">'+(obj[i].saleCountPlus+obj[i].saleCount)+'人约见<span class="ystars"></span><span class="ystars"></span><span class="ystars"></span>';
            	str += '<span class="ystars"></span><span class="ystars"></span></p></div></li>';
            }
            $('.ui-list-product').append(str);
        }
        
        $('.ui-list-product li').tap(function(){
            location.href = "lessonProduct.html?id="+$(this).attr('id');
            return false;
        });
    }
   
    </script>
</body>

</html>
